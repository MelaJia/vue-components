<template>
  <div class="header-section">
    <div class="width-50">
      <div class="header-left">
        <img src="@/assets/img/logo.png" style="height:85px" alt="">
      </div>
    </div>
    <div class="width-50">
      <div class="header-right">
        <el-button v-if="this.$store.getters.roles=='2'" type="danger" size="medium" :class="'process'" icon="el-icon-caret-right" @click="goPage">我的待办</el-button>
        <el-dropdown @command="handleCommand">
          <!-- <span style="color:#fff">你好，{{this.$store.state.user.userinfos.custNickname}}<img src="@/assets/img/juxin_18.png" alt=""></span> -->
          <span style="color:#fff">你好，{{custNickname}}  <span id="img" src="@/assets/img/juxin_18.png" alt=""></span></span>
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item v-if="this.$store.state.user.roles" command="pwdChange">密码修改</el-dropdown-item>
            <el-dropdown-item command="logout"
            v-loading.fullscreen.lock="fullscreenLoading"
            element-loading-text="登出中，请稍候"
            element-loading-spinner="el-icon-loading"
            element-loading-background="rgba(0, 0, 0, 0.8)">登出</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
      </div>
    </div>
  </div>
</template>
<style scoped>
.header-section {
  display: flex;
  justify-content: space-between;
  margin: 0 10px;
  border-radius: 5px;
}

.width-50 {
  display: inline-block;
  width: 49.8%;
}

.header-section {
  font-size: 14px;
}

.header-right {
  display: flex;
  align-items: center;
  float: right;
  height: 100%;
}

.header-left {
}

.header-right img {
  width: 60px;
  height: 60px;
}
.header-right #img {
  background: url("~@/assets/img/juxin_18.png");
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: block;
  position: absolute;
  right: 0;
  top: -5px;
  background-position: -5px -7px;
  background-repeat: no-repeat;
  background-size: 70px 70px;
}
.header-right > span {
  color: #fff;
}

.header-left > div > span {
  height: 17px;
  line-height: 17px;
}

.header-right .process {
  background: #ec960f;
  color: white;
  align-items: center;
  margin-right: 50px;
}

.header-right .process > img {
  width: 32px;
  height: 32px;
}
/* 右侧图标 */
.el-dropdown {
  padding-top: 30px;
}
.el-dropdown > span {
  padding-right: 80px;
}
.el-dropdown > span + span {
  padding-right: 0px;
}
</style>
<script>
import * as types from '@/store/types'
export default {
  data () {
    return {
      dialogPassVisible: false,
      fullscreenLoading: false
    }
  },
  computed: {
    custNickname () {
      return this.$store.state.user.userinfos ? this.$store.state.user.userinfos.custNickname : ''
    }
  },
  methods: {
    pwdChange: pwdChange,
    logout: logout,
    handleCommand (command) {
      if (command === 'logout') {
        this.logout()
      } else {
        console.log('单击了修改密码')
        this.pwdChange()
      }
    },
    // 路由跳转
    goPage () {
      this.$router.push({
        name: 'myschedule' // 跳转到我的待办页面
      })
      // this.$store.commit('getScheduleNumber')
    }
  }
  // computed: {
  //   scheduleNumber () {
  //     return this.$store.getters.scheduleNumber
  //   }
  // }
}
function logout () {
  let param = {
    ssoId: this.$store.getters.token
  }
  this.fullscreenLoading = true
  this.axios.post('/login/logout2', param).then(res => {
    if (res.data.status) {
      this.$message({
        message: '登出成功',
        type: 'success'
      })
      this.$store.commit(types.LOGOUT)
      this.$store.commit('DEL_ALL_TAG')
      this.fullscreenLoading = false
      console.log('登出')
      this.$router.replace({
        path: '/login'
        // query: { redirect: this.$router.currentRoute.fullPath }
      })
    } else {
      this.fullscreenLoading = false
      this.$message({
        message: res.data.data ? res.data.data : '返回结果错误，请联系管理员',
        type: 'error'
      })
    }
  }).catch(err => {
    this.fullscreenLoading = false
    this.$message({
      message: '返回结果错误，请联系管理员',
      type: 'error'
    })
    console.log(err)
  })
}
function pwdChange () {
  this.$emit('pwd-chage')
}
</script>
